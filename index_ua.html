<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ß–∏—Ç–∞–ª–∫–∞ –ë—ñ–±–ª—ñ—ó</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      line-height: 1.8;
      color: #333;
    }
    h1, h2 { color: #2c3e50; }
    .nav { margin-bottom: 20px; padding: 15px; background: #f0f8ff; border-radius: 8px; }
    .verse { margin: 8px 0; }
    .verse-num { font-weight: bold; color: #c44; }
    .interface-on .nav { display: block; }
    .interface-off .nav { display: none; }
    .ref-link { font-size: 0.9em; color: #555; }
    .footer { margin-top: 40px; font-size: 0.9em; color: #777; text-align: center; }
  </style>
</head>
<body class="interface-off">
  <div class="nav">
    <h2>üìñ –ß–∏—Ç–∞–ª–∫–∞ –ë—ñ–±–ª—ñ—ó</h2>
    <p>
      <input type="text" id="ref-input" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 1,2:5-7" size="30" />
      <button onclick="go()">–ü–µ—Ä–µ–π—Ç–∏</button>
    </p>
    <p class="ref-link">–ü–æ—Ç–æ—á–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è: <code id="current-url"></code></p>
  </div>

  <div id="content"></div>

  <div class="footer">
    –ß–∏—Ç–∞–ª–∫–∞ –¥–ª—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ–≥–æ –ø–µ—Ä–µ–∫–ª–∞–¥—É –û–≥—ñ—î–Ω–∫–∞
  </div>

  <script>
    // === –ù–∞–∑–≤–∏ –∫–Ω–∏–≥ (–≤ –ø–æ—Ä—è–¥–∫—É –ë—ñ–±–ª—ñ—ó) ===
    const books = [
      "–ë—É—Ç—Ç—è", "–í–∏—Ö—ñ–¥", "–õ–µ–≤–∏—Ç", "–ß–∏—Å–ª–∞", "–ü–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è –ó–∞–∫–æ–Ω—É",
      "–Ü—Å—É—Å –ù–∞–≤–∏–Ω", "–°—É–¥–¥—ñ", "–†—É—Ñ", "1 –¶–∞—Ä", "2 –¶–∞—Ä",
      "3 –¶–∞—Ä", "4 –¶–∞—Ä", "1 –õ–µ—Ç–æ–ø–∏—Å", "2 –õ–µ—Ç–æ–ø–∏—Å", "–ï–∑–¥—Ä–∞",
      "–ù–µ–µ–º—ñ—è", "–ï—Å—Ç–µ—Ä", "–ô–æ–≤–∞", "–ü—Å–∞–ª—Ç–∏—Ä", "–ü—Ä–æ—Ä–æ–∫–∏",
      "–Ñ—Ä–µ–º—ñ—è", "–ü–ª–∞—á –Ñ—Ä–µ–º—ñ—ó", "–ü–æ—Å–ª–∞–Ω–Ω—è –¥–æ –í–∞–≤–∏–ª–æ–Ω—è–Ω", "–Ñ–∑–µ–∫–∏—ó–ª—å", "–î–∞–Ω—ñ—ó–ª",
      "–û—Å—ñ—è", "–ô–æ–µ–ª—å", "–ê–º–æ—Å", "–ê–≤–¥—ñ–π", "–ô–æ–Ω–∞",
      "–ú–∏—Ö–µ–π", "–ù–∞—É–º", "–ê–≤–∞–∫—É–º", "–°–æ—Ñ–æ–Ω—ñ—è", "–ê–≥–≥–µ–π",
      "–ó–∞—Ö–∞—Ä—ñ—è", "–ú–∞–ª–∞—Ö—ñ—è", "–ú–∞—Ç–≤—ñ—è", "–ú–∞—Ä–∫–∞", "–õ—É–∫–∏",
      "–Ø–Ω–∞", "–î—ñ—ó", "–†–∏–º–ª—è–Ω–∞–º", "1 –ö–æ—Ä–∏–Ω—Ñ'—è–Ω–∞–º", "2 –ö–æ—Ä–∏–Ω—Ñ'—è–Ω–∞–º",
      "–ì–∞–ª–∞—Ç–∞–º", "–ï—Ñ–µ—Å—è–Ω–∞–º", "–§–∏–ª–∏–º–æ–Ω–æ–≤—ñ", "–ö–æ–ª–æ—Å—Å—è–Ω–∞–º", "1 –°–æ–ª—É–Ω—è–Ω–∞–º",
      "2 –°–æ–ª—É–Ω—è–Ω–∞–º", "1 –¢–∏–º–æ—Ñ—ñ—é", "2 –¢–∏–º–æ—Ñ—ñ—é", "–¢–∏—Ç–æ–≤—ñ", "–§–∏–ª–∏–º–æ–Ω–æ–≤—ñ",
      "–Ñ–≤—Ä–µ—è–º", "–Ø–∫—ñ–≤", "1 –ü–µ—Ç—Ä–∞", "2 –ü–µ—Ç—Ä–∞", "1 –Ü–≤–∞–Ω–∞",
      "2 –Ü–≤–∞–Ω–∞", "3 –Ü–≤–∞–Ω–∞", "–Æ–¥–∏", "–û–±'—è–≤–ª–µ–Ω–Ω—è"
    ];

    // === –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ JSON –∑ —Ñ–∞–π–ª—É ===
    let bibleData = null;

    async function loadBible() {
      try {
        const res = await fetch('https://raw.githubusercontent.com/christian-word/bible-reader/refs/heads/main/json/bible_ua.json');
        const rawData = await res.json();
        
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–∏—Ö
        if (Array.isArray(rawData)) {
          bibleData = rawData;
        } else if (rawData.chapters && Array.isArray(rawData.chapters)) {
          bibleData = rawData.chapters;
        } else {
          throw new Error('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON –¥–∞–Ω–∏—Ö');
        }
        
        parseUrl();
      } catch (err) {
        document.getElementById('content').innerHTML = '<p style="color:red">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö: ' + err.message + '</p>';
        console.error(err);
      }
    }

    // === –ü–∞—Ä—Å–∏–º URL ===
    function parseUrl() {
      const urlParams = new URLSearchParams(window.location.search);
      const ref = urlParams.get('ref');
      const showInterface = urlParams.has('i') || urlParams.has('—ñ') || urlParams.has('–∏');

      if (showInterface) {
        document.body.className = 'interface-on';
      } else {
        document.body.className = 'interface-off';
      }

      if (ref) {
        displayReference(ref);
        document.getElementById('ref-input').value = ref;
      } else {
        document.getElementById('content').innerHTML = '<p>–í–≤–µ–¥—ñ—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è —É —Ñ–æ—Ä–º–∞—Ç—ñ: <code>1,2:5-7</code></p>';
      }

      updateCurrentUrl();
    }

    // === –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ —Å—Ç–∏—Ö–∏ ===
    function displayReference(ref) {
      if (!bibleData) {
        document.getElementById('content').innerHTML = '<p style="color:red">–î–∞–Ω—ñ –ë—ñ–±–ª—ñ—ó –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ</p>';
        return;
      }

      const match = ref.match(/^(\d+),(\d+)(?::(\d+)(?:-(\d+))?)?$/);
      if (!match) {
        document.getElementById('content').innerHTML = '<p>–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç. –ü—Ä–∏–∫–ª–∞–¥: <code>1,2:5-7</code></p>';
        return;
      }

      const bookNum = parseInt(match[1]);
      const chapterNum = parseInt(match[2]);
      const startVerse = match[3] ? parseInt(match[3]) : null;
      const endVerse = match[4] ? parseInt(match[4]) : startVerse;

      const bookName = books[bookNum - 1];
      if (!bookName) {
        document.getElementById('content').innerHTML = '<p>–ö–Ω–∏–≥–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞</p>';
        return;
      }

      // –®—É–∫–∞—î–º–æ –≥–ª–∞–≤—É –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –º–æ–∂–ª–∏–≤–æ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö
      let chapter = null;
      
      // –°–ø—Ä–æ–±–∞ 1: –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
      if (!chapter) {
        chapter = bibleData.find(ch => ch.book === bookName && ch.chapter === chapterNum);
      }
      
      // –°–ø—Ä–æ–±–∞ 2: —ñ–Ω—à–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
      if (!chapter) {
        chapter = bibleData.find(ch => 
          ch.book_number === bookNum && ch.chapter_number === chapterNum
        );
      }

      if (!chapter) {
        document.getElementById('content').innerHTML = `<p>–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ: ${bookName} ${chapterNum}</p>`;
        return;
      }

      let html = '';
      let verses = chapter.verses || chapter.verse_objects || [];
      
      if (startVerse === null) {
        // –í—Å—è –≥–ª–∞–≤–∞
        html += `<h2>${bookName} ${chapterNum}</h2>`;
        verses.forEach(v => {
          const verseNum = v.verse || v.verse_number || v.number;
          const verseText = v.text || v.content || '';
          if (verseNum && verseText) {
            html += `<div class="verse"><span class="verse-num">${verseNum}</span> ${verseText}</div>`;
          }
        });
      } else {
        // –î—ñ–∞–ø–∞–∑–æ–Ω —Å—Ç–∏—Ö—ñ–≤
        const filteredVerses = verses.filter(v => {
          const verseNum = v.verse || v.verse_number || v.number;
          return verseNum && verseNum >= startVerse && (!endVerse || verseNum <= endVerse);
        });
        
        if (filteredVerses.length === 0) {
          html = `<p>–°—Ç–∏—Ö–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ: ${ref}</p>`;
        } else {
          html += `<h2>${bookName} ${chapterNum}:${startVerse}${endVerse ? '-' + endVerse : ''}</h2>`;
          filteredVerses.forEach(v => {
            const verseNum = v.verse || v.verse_number || v.number;
            const verseText = v.text || v.content || '';
            if (verseNum && verseText) {
              html += `<div class="verse"><span class="verse-num">${verseNum}</span> ${verseText}</div>`;
            }
          });
        }
      }

      document.getElementById('content').innerHTML = html;
    }

    // === –ü–µ—Ä–µ—Ö—ñ–¥ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º ===
    function go() {
      const input = document.getElementById('ref-input').value.trim();
      const showInterface = document.body.classList.contains('interface-on') ? '&i' : '';
      if (input) {
        window.location.search = 'ref=' + encodeURIComponent(input) + showInterface;
      }
    }

    // === –û–Ω–æ–≤–ª–µ–Ω–Ω—è URL –≤ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ ===
    function updateCurrentUrl() {
      const ref = new URLSearchParams(window.location.search).get('ref') || '';
      const showInterface = ['i', '—ñ', '–∏'].some(param => new URLSearchParams(window.location.search).has(param));
      const baseUrl = window.location.pathname + '?ref=' + encodeURIComponent(ref);
      const fullUrl = showInterface ? baseUrl + '&i' : baseUrl;
      document.getElementById('current-url').textContent = fullUrl;
    }

    // === –û–±—Ä–æ–±–∫–∞ Enter —É –ø–æ–ª—ñ ===
    document.getElementById('ref-input').addEventListener('keypress', e => {
      if (e.key === 'Enter') go();
    });

    // === –ó–∞–ø—É—Å–∫ ===
    window.onload = loadBible;
  </script>
</body>
</html>
